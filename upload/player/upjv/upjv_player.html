<!--
	  PARAMETRES
-->
{$default_quality = get_upjv_quality_type($video_files)}
{$availablePlaySpeed = "[1, 1.5, 2]"}
{$preload = "none"}
<!--    
	STREAMING INFO
	Pour une lecture HLS (streaming), le type a indiquer n'est pas le mÃªme :
	    <source src='{$file}' type="application/x-mpegURL">

	Plugin videoJS pour lecture de flux HLS :
	    <script src="{$baseurl}/player/videojs-contrib-hls.min.js"></script>

	Norme WebVTT :
		https://w3c.github.io/webvtt/
-->

  
<!-- PLAYER CSS -->
<link href="{$upjv_player_v2_url}/app/css/video-js.min.css" rel="stylesheet">

<link href="{$upjv_player_v2_url}/app/css/video-js.custom.css" rel="stylesheet">
<!-- PLUGIN CSS -->
<link href="{$upjv_player_v2_url}/app/css/videojs-resolution-switcher.css" rel="stylesheet">

<!--
	  PLAYER JS
-->
{if $development_mode}
<script src="{$upjv_player_v2_url}/app/js/video.js"></script>
{else}
<script src="{$upjv_player_v2_url}/app/js/video.min.js"></script>
{/if}  

<!-- 
<script src="{$upjv_player_v2_url}/app/js/video_js_custom.js"></script>
 -->

<!--
	  PLAYER PLUGIN JS
-->
<script src="{$upjv_player_v2_url}/app/js/videojs-resolution-switcher.js"></script>


<!--
	  PLAYER FLASH ALTERNATIVE
-->
<script>
	videojs.options.flash.swf = "{$upjv_player_v2_url}/app/swf/video-js.swf"
</script>


<!--
	  BALISE VIDEO HTML 5 height="{$height}" width="{$width}"
-->
<video id="cb_video_js" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="{$preload}" poster="{getThumb vdetails=$vdata size=big}">


    {foreach $video_files as $file}
	    {$quality = get_upjv_quality($file)}

	    {if $flv_vid == true}
		<source src='{$file}' type="video/x-flv" />
	    {else}
		<source src='{$file}' type="video/mp4" label="{strtoupper($quality)}" res="{$quality}" />
	    {/if}
    {/foreach}
	
	<!-- Use by Subtitle Maker plugin -->
    {ANCHOR place="getSubtitleVtt" data=$vdata}

    {ANCHOR place="play_def_sub"}

    <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
</video>


<!--
	  CONFIGURATION PLAYER
-->
<script type="text/javascript">
	var default_res = "{$default_quality}";
	var availablePlaySpeed = {$availablePlaySpeed};
</script>

<script type="text/javascript">
var preloadValue = "auto";

var string = window.location.href, substring = "embed_player";

if (string.indexOf(substring) !== -1){
	preloadValue = "none";
}

	var player = videojs('cb_video_js', {
		plugins: {
			videoJsResolutionSwitcher: {
				default: default_res,
				dynamicLabel: false
			}
		},
		preload: preloadValue,
		playbackRates: availablePlaySpeed,
		fluid: true,
		LoadingSpinner: true,
		BigPlayButton: true,
		controlBar: {
			muteToggle: false
		},
		html5: {
			nativeTextTracks: false
		}
	});


$( document ).ready(function() {

//	var myplayer = videojs('cb_video_js');
//	console.log("Yep");
//	console.log(player);.buffered.length

	var buf = player.buffered();
	var bufe = player.bufferedEnd();
	var bufp = player.bufferedPercent();


	setInterval(function(){
		console.log("Buff : " + buf + " End : " + bufe + " % : " + bufp );
	}, 1000);

});

</script>

<!--
	  STYLE PLAYER
-->
<style type="text/css">
	.video-js {
		width: 100%;
	}
	.video-js .vjs-tech {
		height: 100% !important;
	}
	.editorpick .cb_video_js-dimensions{
		width: 100% !important;
		height: 100% !important;
	}
</style>

