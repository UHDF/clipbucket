/**
 * videojs-lvp-chapter
 * @version 0.0.0
 * @copyright 2017 Bastien <bastien.poirier@univ-lille1.fr>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsLvpChapter=t(e.videojs)}(this,function(e){"use strict";var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=(e="default"in e?e["default"]:e).registerPlugin||e.plugin,a=function(){function e(n){t(this,e),this.player=n,this.cBtn=undefined,this.container=undefined,this.chapters=[],this.defaults={textChapter:"Chapitres"}}return e.prototype.cueChange=function(e){for(var t=e.activeCues,n=null,a=this.container.querySelectorAll("li"),i=0;i<a.length;i++)a[i].className="";if(1===t.length)n=t[0].id;else{var s=Math.round(100*this.player.currentTime());for(var r in this.chapters)Math.round(100*this.chapters[r].cue.startTime)<=s&&(n=r)}null!==n&&(this.chapters[n].li.className="current")},e.prototype.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},e.prototype.onToggleList=function(e){var t=e?e.currentTarget.parentNode:this.container;-1==t.className.indexOf("active")?t.className+=" active":t.className=t.className.replace(" active","")},e.prototype.onChangeChapter=function(e){var t=e;if(t){this.player.paused();this.player.currentTime(t.startTime),this.cueChange({activeCues:[t]})}this.onToggleList()},e.prototype.getStyle=function(e,t){return window.getComputedStyle(e,null).getPropertyValue(t)},e.prototype.onResize=function(){var e=parseInt(this.getStyle(this.player.el(),"height"))-parseInt(this.getStyle(this.player.controlBar.el(),"height"))-parseInt(this.getStyle(this.container,"height"));this.container.querySelector(".vjs-lvp-chapter-list ul").style.maxHeight=e+"px"},e.prototype.createElt=function(){var e=this,t=this.chapters;this.chapters={},this.container=document.createElement("div"),this.container.className="vjs-lvp-chapter-container";var n=document.createElement("div");n.className="vjs-lvp-chapter-btn",n.setAttribute("title",this.defaults.textChapter),n.innerHTML='<span class="vjs-lvp-chapter-label">'+this.defaults.textChapter+'</span><span class="vjs-lvp-chapter-hamburger"><span class="vjs-lvp-hamburger-inner"></span></span>';var a=document.createElement("div");a.className="vjs-lvp-chapter-list";var i=document.createElement("ul");t.map(function(t){var n=document.createElement("li");n.innerText=t.text,e.addEvent(n,"click",function(n){n.preventDefault(),e.onChangeChapter(t)}),i.appendChild(n),e.chapters[t.id]={li:n,cue:t}}),this.addEvent(n,"click",this.onToggleList),a.appendChild(i),this.container.appendChild(n),this.container.appendChild(a),this.player.el().appendChild(this.container),this.assignEvents(),this.player.addClass("vjs-lvp-chapter")},e.prototype.assignEvents=function(){var e=this;this.addEvent(document,"click",function(t){for(var n=t.target,a=!1;!a&&null!==n.parentNode&&n.parentNode!==document.documentElement;)n==e.container&&(a=!0),n=n.parentNode;a||-1===e.container.className.indexOf("active")||e.onToggleList()}),this.player.on("firstplay",function(){e.onResize()}),this.addEvent(this.player.el(),"resize",function(){e.onResize()})},e.prototype.init=function(){var e=this,t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;null!==t&&(this.defaults=t);for(var n=this.player.textTracks(),a=null,i=0;i<n.length;i++){var s=n[i];"chapters"===s.kind&&(a=s)}if(null!==a){var r=a.cues;if(null===r){var l=this;return void setTimeout(function(){l.init()},100)}for(var c=0;c<r.length;c++)this.chapters.push(r[c]);this.addEvent(a,"cuechange",function(){e.cueChange(a)})}0!==this.chapters.length&&this.createElt()},e}(),i=function(t){var n=this;this.ready(function(){n.on("loadedmetadata",function(){var n=new a(this);n.init(e.mergeOptions(n.defaults,t))})})};return n("lvpChapter",i),i.VERSION="0.0.0",i});